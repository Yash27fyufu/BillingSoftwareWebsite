CREATE TABLE USERS (
    USER_ID int NOT NULL AUTO_INCREMENT,
    USER_NAME varchar(50) NOT NULL UNIQUE,
    USER_PASSWORD varchar(255) NOT NULL,
    PRIMARY KEY (USER_ID)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE PARTIES (
  PARTY_ID int NOT NULL AUTO_INCREMENT,
  PARTY_NAME varchar(80) NOT NULL,
  PARTY_ADDRESS varchar(200) DEFAULT NULL,
  PARTY_PINCODE int DEFAULT NULL,
  PARTY_MAIL varchar(100) DEFAULT NULL,
  PARTY_GST varchar(20) DEFAULT NULL,
  PARTY_NUMBER_1 varchar(15) DEFAULT NULL,
  PARTY_NUMBER_2 varchar(15) DEFAULT NULL,
  PARTY_OPENING_BALANCE float DEFAULT NULL,
  DISPLAY tinyint(1) DEFAULT 1,
  PARTY_OPENING_BALANCE_DATE DATE DEFAULT NULL,
    BILLING_NAME VARCHAR(100) DEFAULT NULL,
    TRANSPORT_NAME VARCHAR(50) DEFAULT NULL,
    TO_RECEIVE TINYINT(1) DEFAULT null,
  PRIMARY KEY (PARTY_ID)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE CASH_PARTIES (
  PARTY_ID int NOT NULL AUTO_INCREMENT,
  BILLING_NAME varchar(100) NOT NULL,
  PARTY_ADDRESS varchar(200) DEFAULT NULL,
  PARTY_PINCODE int DEFAULT NULL,
  PARTY_MAIL varchar(100) DEFAULT NULL,
  PARTY_GST varchar(20) DEFAULT NULL,
  PARTY_NUMBER_1 varchar(15) DEFAULT NULL,
  PARTY_NUMBER_2 varchar(15) DEFAULT NULL,
  DISPLAY tinyint(1) DEFAULT 1,
  PRIMARY KEY (PARTY_ID)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE PARTIES_NOTE (
PARTY_ID INT NOT NULL,
NOTE VARCHAR(200),
    FOREIGN KEY (PARTY_ID) REFERENCES PARTIES (PARTY_ID) ON DELETE CASCADE

) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE CASH_PARTIES_NOTE (
  CASH_PARTY_ID INT NOT NULL,
  NOTE VARCHAR(200),
      FOREIGN KEY (CASH_PARTY_ID) REFERENCES CASH_PARTIES (PARTY_ID) ON DELETE CASCADE
  
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE UNIT (
    UNIT_ID int NOT NULL AUTO_INCREMENT,
    UNIT_NAME varchar(25) NOT NULL,
    UNIT_SHORT_FORM varchar(10) NOT NULL,
    DISPLAY tinyint(1) DEFAULT 1,
    PRIMARY KEY (UNIT_ID),
    UNIQUE KEY UNIT_NA (UNIT_NAME)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE gst_type (
    GST_ID int NOT NULL AUTO_INCREMENT,
    GST_PERCENTAGE int NOT NULL,
    DISPLAY tinyint(1) DEFAULT 1,
    PRIMARY KEY (GST_ID),
    UNIQUE KEY GST_PERC (GST_PERCENTAGE)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE HSN_DETAILS (
    HSN_ID int NOT NULL AUTO_INCREMENT,
    HSN_CODE varchar(10) NOT NULL,
    GST_REF_ID int DEFAULT NULL,
    DISPLAY tinyint(1) DEFAULT 1,
    PRIMARY KEY (HSN_ID),
    FOREIGN KEY (GST_REF_ID) REFERENCES GST_TYPE (GST_ID) ON DELETE SET NULL
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE ITEMS (
    ITEM_ID int NOT NULL AUTO_INCREMENT,
    ITEM_NAME varchar(255) NOT NULL,
    ITEM_CODE varchar(50) DEFAULT NULL,
    ITEM_GST_TYPE_ID int DEFAULT NULL,
    ITEM_BRAND varchar(100) DEFAULT NULL,
    ITEM_PURCHASE_PRICE float DEFAULT NULL,
    ITEM_PURCHASE_DISCOUNT float DEFAULT NULL,
    ITEM_PURCHASE_QUANTITY float DEFAULT NULL,
    ITEM_SALES_PRICE float DEFAULT NULL,
    ITEM_SALES_DISCOUNT float DEFAULT NULL,
    ITEM_SALES_QUANTITY float DEFAULT NULL,
    ITEM_DEFAULT_UNIT_ID int DEFAULT NULL,
    DISPLAY tinyint(1) DEFAULT 1,
    ITEM_OPENING_QTY int DEFAULT NULL,
    ITEM_HSN_ID int DEFAULT NULL,
    PRIMARY KEY (ITEM_ID),
    FOREIGN KEY (ITEM_GST_TYPE_ID) REFERENCES GST_TYPE (GST_ID),
    FOREIGN KEY (ITEM_DEFAULT_UNIT_ID) REFERENCES UNIT (UNIT_ID),
    FOREIGN KEY (ITEM_HSN_ID) REFERENCES HSN_DETAILS (HSN_ID)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE ITEM_DESCRIPTIONS(
ITEM_ID INT NOT NULL,
ITEM_DESCRIPTION VARCHAR(250),
FOREIGN KEY (ITEM_ID) REFERENCES ITEMS (ITEM_ID)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE bill_series (
    BILL_SERIES_ID int NOT NULL AUTO_INCREMENT,
    BILL_SERIES varchar(25) NOT NULL,
    DISPLAY tinyint(1) DEFAULT 1,
    PREFIX tinyint(1) NOT NULL,
    PRIMARY KEY (BILL_SERIES_ID)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE bill_details (
    BILL_DETAILS_ID int NOT NULL AUTO_INCREMENT,
    BILL_ID int NOT NULL,
    BILL_TYPE varchar(20) DEFAULT NULL,
    PACKINGS int DEFAULT NULL,
    SHIPPING_ADDRESS varchar(150) DEFAULT NULL,
    TRANSPORT varchar(70) DEFAULT NULL,
    SUBTOTAL float DEFAULT NULL,
    ROUND_OFF float DEFAULT NULL,
    FREIGHT float DEFAULT NULL,
    DISCOUNT_PERC float DEFAULT NULL,
    TOTAL float DEFAULT NULL,
    AMOUNT_SETTLED float DEFAULT NULL,
    PRIMARY KEY (BILL_DETAILS_ID)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE SALES_BILL (
    SALES_ID int NOT NULL AUTO_INCREMENT,
    PARTY_ID int NOT NULL,
    BILL_SERIES_ID int DEFAULT NULL,
    BILL_NUMBER VARCHAR(10) NOT NULL,
    BILL_DATE datetime NOT NULL,
    BILL_CREATED_DATE datetime NOT NULL,
    BILL_LAST_UPDATED datetime NOT NULL,
    BILL_YEAR int NOT NULL,
    CASH_ENTRY tinyint(1) DEFAULT NULL,
    PRIMARY KEY (SALES_ID),
    FOREIGN KEY (BILL_SERIES_ID) REFERENCES BILL_SERIES (BILL_SERIES_ID),
    CONSTRAINT CHK_BILL_NUMBER_DIGITS CHECK (BILL_NUMBER REGEXP '^[0-9]+$')
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE bill_items (
    BILL_ITEM_ID int NOT NULL AUTO_INCREMENT,
    BILL_DETAILS_ID int NOT NULL,
    BILL_ID int NOT NULL,
    ITEM_ID int NOT NULL,
    QUANTITY float DEFAULT NULL,
    UNIT_ID int DEFAULT NULL,
    PRICE float DEFAULT NULL,
    DISCOUNT float DEFAULT NULL,
    GST_ID int DEFAULT NULL,
    BILL_TYPE varchar(20) DEFAULT NULL,
    PRIMARY KEY (BILL_ITEM_ID),
    FOREIGN KEY (BILL_DETAILS_ID) REFERENCES bill_details (BILL_DETAILS_ID),
    FOREIGN KEY (ITEM_ID) REFERENCES ITEMS (ITEM_ID),
    FOREIGN KEY (UNIT_ID) REFERENCES UNIT (UNIT_ID) ON DELETE SET NULL,
    FOREIGN KEY (GST_ID) REFERENCES GST_TYPE (GST_ID) ON DELETE SET NULL
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE BILL_NOTE (
    BILL_NOTE_ID int NOT NULL AUTO_INCREMENT,
    BILL_DETAILS_ID int NOT NULL,
    BILL_ID int NOT NULL,
    BILL_TYPE varchar(20) DEFAULT NULL,
    BILL_NOTE varchar(200) DEFAULT NULL,
    PRIMARY KEY (BILL_NOTE_ID),
    FOREIGN KEY (BILL_DETAILS_ID) REFERENCES BILL_DETAILS (BILL_DETAILS_ID)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE USER_COMPANY_DETAILS (
    COMPANY_ID int NOT NULL AUTO_INCREMENT,
    COMPANY_NAME varchar(70) NOT NULL,
    COMPANY_ADDRESS varchar(200) DEFAULT NULL,
    COMPANY_PINCODE int DEFAULT NULL,
    COMPANY_PHONE_NUMBER varchar(15) DEFAULT NULL,
    COMPANY_EMAIL varchar(70) DEFAULT NULL,
    COMPANY_GSTIN varchar(15) DEFAULT NULL,
    STATE_CODE varchar(2) DEFAULT NULL,
    USER_ID int DEFAULT NULL,
    PRIMARY KEY (COMPANY_ID),
    UNIQUE (USER_ID, COMPANY_NAME),
    FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE USER_TOKENS (
    TOKEN_ID int NOT NULL AUTO_INCREMENT,
    USER_TOKEN varchar(255) NOT NULL UNIQUE,
    TOKEN_EXPIRY_TIME datetime not null,
    DEVICE_IP varchar(30),
    USER_ID int NOT NULL,
    PRIMARY KEY (TOKEN_ID),
    FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID) ON DELETE CASCADE
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE PAYMENT_MODES (
  PAYMENT_MODE_ID int NOT NULL,
  MODE_NAME varchar(100) DEFAULT NULL,
  DISPLAY tinyint(1) DEFAULT NULL,
  PRIMARY KEY (PAYMENT_MODE_ID)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE PAYMENTS (
  PAYMENT_ID int NOT NULL AUTO_INCREMENT,
  PAYMENT_MODE_ID int NOT NULL,
  AMOUNT float not NULL,
  PAYMENT_DATE date not NULL,
  PAYMENT_TYPE enum('IN', 'OUT', 'P2P') NOT NULL,
  PRIMARY KEY (PAYMENT_ID),
  CONSTRAINT CHK_AMOUNT_NON_ZERO CHECK (AMOUNT <> 0)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE P2PTRANSFER (
  PAYMENT_ID int NOT NULL,
  FROM_PARTY_ID int DEFAULT NULL,
  TO_PARTY_ID int DEFAULT NULL,
   CONSTRAINT CHK_NOT_SAME_PARTY CHECK (FROM_PARTY_ID <> TO_PARTY_ID),
FOREIGN KEY (PAYMENT_ID) REFERENCES payments (PAYMENT_ID),
  FOREIGN KEY (FROM_PARTY_ID) REFERENCES PARTIES (PARTY_ID),
  FOREIGN KEY (TO_PARTY_ID) REFERENCES PARTIES (PARTY_ID) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE payment_allocation (
    PAYMENT_ALLOCATION_ID int NOT NULL AUTO_INCREMENT,
    PAYMENT_ID int NOT NULL,
    AMOUNT float NOT NULL,
    BILL_DETAILS_ID int NOT NULL,
    BILL_ID int NOT NULL,
    BILL_TYPE varchar(20) NOT NULL,
    PRIMARY KEY (PAYMENT_ALLOCATION_ID),
    FOREIGN KEY (PAYMENT_ID) REFERENCES PAYMENTS (PAYMENT_ID) ON DELETE CASCADE,
    FOREIGN KEY (BILL_DETAILS_ID) REFERENCES BILL_DETAILS (BILL_DETAILS_ID) ON DELETE CASCADE,
    CONSTRAINT CHK_AMOUNT_NON_ZERO2 CHECK (AMOUNT <> 0)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;